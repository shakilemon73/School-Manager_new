<!DOCTYPE html>
<html>
<head>
    <title>Test School Settings API</title>
</head>
<body>
    <h1>School Settings API Test</h1>
    <div id="status"></div>
    <div id="data"></div>
    <form id="updateForm">
        <h2>Update School Settings</h2>
        <input type="text" id="name" placeholder="School Name" required>
        <input type="text" id="principalName" placeholder="Principal Name" required>
        <input type="email" id="email" placeholder="Email" required>
        <button type="submit">Update Settings</button>
    </form>

    <script>
        const statusDiv = document.getElementById('status');
        const dataDiv = document.getElementById('data');
        const form = document.getElementById('updateForm');

        // Test API fetch
        async function testAPI() {
            statusDiv.innerHTML = 'Testing Supabase API...';
            
            try {
                const response = await fetch('/api/supabase/school/settings');
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.innerHTML = '✅ API Working - Source: ' + result.source;
                    dataDiv.innerHTML = '<pre>' + JSON.stringify(result.data, null, 2) + '</pre>';
                    
                    // Populate form with current data
                    document.getElementById('name').value = result.data.name || '';
                    document.getElementById('principalName').value = result.data.principalName || '';
                    document.getElementById('email').value = result.data.email || '';
                } else {
                    statusDiv.innerHTML = '❌ API Failed: ' + result.message;
                }
            } catch (error) {
                statusDiv.innerHTML = '❌ Error: ' + error.message;
            }
        }

        // Test update
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                name: document.getElementById('name').value,
                principalName: document.getElementById('principalName').value,
                email: document.getElementById('email').value
            };

            try {
                const response = await fetch('/api/supabase/school/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (result.success) {
                    statusDiv.innerHTML = '✅ Update Successful - Action: ' + result.action;
                    testAPI(); // Refresh data
                } else {
                    statusDiv.innerHTML = '❌ Update Failed: ' + result.error;
                }
            } catch (error) {
                statusDiv.innerHTML = '❌ Update Error: ' + error.message;
            }
        });

        // Run test on load
        testAPI();
    </script>
</body>
</html>